<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>iOS Application Security Part 10 – iOS Filesystem and Forensics | Prateekg147</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="iOS Application Security Part 10 – iOS Filesystem and Forensics" />
<meta name="author" content="Prateek Gianchandani" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this article, we will be looking at the iOS filesystem, understand how the directories are organized, look at some important files, and look at how we can extract data from database and plist files. We will look at how applications store their data in their specific directories (sandbox) and how we can extract them." />
<meta property="og:description" content="In this article, we will be looking at the iOS filesystem, understand how the directories are organized, look at some important files, and look at how we can extract data from database and plist files. We will look at how applications store their data in their specific directories (sandbox) and how we can extract them." />
<meta property="og:site_name" content="Prateekg147" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-08-20T07:32:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="iOS Application Security Part 10 – iOS Filesystem and Forensics" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Prateek Gianchandani"},"dateModified":"2013-08-20T07:32:00+00:00","datePublished":"2013-08-20T07:32:00+00:00","description":"In this article, we will be looking at the iOS filesystem, understand how the directories are organized, look at some important files, and look at how we can extract data from database and plist files. We will look at how applications store their data in their specific directories (sandbox) and how we can extract them.","headline":"iOS Application Security Part 10 – iOS Filesystem and Forensics","mainEntityOfPage":{"@type":"WebPage","@id":"/2013/08/20/ios-application-security-part-10-ios-filesystem-and-forensics.html"},"url":"/2013/08/20/ios-application-security-part-10-ios-filesystem-and-forensics.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Prateekg147" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Blogs<b class="command_prompt"></b></a>
    <a class="site-title" rel="author" href="/about">About<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-cyan-hover" href="https://twitter.com/prateekg147"><i class="fab fa-twitter-square"></i></a>
        
        
        
        <a class="color-indigo-hover" href="https://www.linkedin.com/in/prateekgianchandani/"><i class="fab fa-linkedin"></i></a>
        
        
        
        <a class="color-yellow-hover" href="https://github.com/prateek147"><i class="fab fa-github-square"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    https://pbs.twimg.com/profile_images/1244561732170899457/SRr3p2iV_400x400.jpg
" class="author-avatar" alt="Avatar" />
<div class="description">I am Prateek Gianchandani. Currently i am working as a Security Researcher in UAE.  I have interests in Exploit Development, Mobile and Browser Security....<a href="/about"> Continue</a>
</div>

</div>


<div class="post">
  <h1 class="post-title">iOS Application Security Part 10 – iOS Filesystem and Forensics</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/security/">security</a>
      
  </div>
  
  <div class="post-date">
    Published on 20 Aug 2013
    
  </div>
  
  <p>In this article, we will be looking at the iOS filesystem, understand how the directories are organized, look at some important files, and look at how we can extract data from database and plist files. We will look at how applications store their data in their specific directories (sandbox) and how we can extract them.</p>

<!-- more -->

<p>One of the important things to note is that in all the previous articles, we have been logging in to the device as the user <em>root</em>. There is another kind of user with the username <em>mobile</em>. A mobile user has less privileges than a root user. All the applications run with the user <em>mobile</em>, with the exception of Cydia and some other applications which run with root privileges. Some of Apple’s internal daemons or services also run with root privileges. A quick <em>ps aux</em> will make this very clear. On the extreme left, you will see the USER column. We can see that Cydia runs with root privileges, whereas all other applications run with mobile user, for e.g <em>/Applications/AppStore.app/AppStore</em> while some of the daemons for e.g <em>/usr/sbin/wifid</em> run with root privileges. Some other applications that you install via Cydia may also run with root privileges. By default, once you jailbreak the device, the password for both root and mobile user is <em>alpine</em>.</p>

<p><img src="/images/posts/ios10/1.png" alt="1" /></p>

<p>It is possible for you to configure an app to run with root privileges. For more details on it, check out <a href="http://stackoverflow.com/a/8796556/119114">this</a> answer on Stack Overflow.</p>

<p>Let’s ssh into the device. Go to /Applications. You can see some apps in this folder. Most of them are apps that come preinstalled with iOS, and then there are some apps installed via Cydia, for e.g the Terminal app. Please note that all the apps running inside /Applications folder don’t run in a sandboxed environment whereas all the applications in the location /var/mobile/Applications run in a sandboxed environment. We will discuss sandboxing later in this article. However, they still run with the user <em>mobile</em> by default unless specifically configured to run with the user <em>root</em>.</p>

<p><img src="/images/posts/ios10/2.png" alt="2" /></p>

<p>All the apps downloaded from the App Store go inside the <em>/var/mobile/Applications/</em> directory. It also contains the apps that you installed using installipa or an external source like Cydia. All these apps run in a sandboxed environment.</p>

<p><img src="/images/posts/ios10/3.png" alt="3" /></p>

<p>Please note that from iOS 4 or later, every app resides in an environment called Sandbox. The main purpose of this is to ensure that the app is not allowed to access any data outside of its own sandbox. This ensures better security. It is however possible to access certain portions of the user data from within an application using proper permissions. This includes permission to fetch the user’s Contacts, photos etc. However, there has been certain debate about this as well. For e.g from iOS 6, an app can get access to a user’s contacts after taking proper permission from the user. Prior to this, an app could access a user’s contacts without taking any permission from the user and it caused quite a <a href="http://arstechnica.com/gadgets/2012/02/path-addresses-privacy-controversy-but-social-apps-remain-a-risk-to-users/">controversy</a> for the Path app.</p>

<p>It is also possible to access many other things outside of an app’s sandbox using Entitlements. You can read the complete documentation <a href="http://developer.apple.com/library/ios/#documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/EnablingAppSandbox.html">here</a>. For e.g, to access read write permissions to the calendar of a user, the entitlements key <em>com.apple.security.personal-information.calendars</em> has to be marked as YES in the <em>.entitlements</em> file.</p>

<p>Let’s look at the directory structure of a particular application. Let’s go inside the Snapchat app directory. This directory structure is common for all apps.</p>

<p><img src="/images/posts/ios10/4.png" alt="4" /></p>

<ul>
  <li>The Snapchat.app (Appname.app) folder contains all the assets (images), plist files and the binary for the app.</li>
  <li>The Documents folder is to used to store any file. This provides a seperate directory to this application folder that could only be used within the context of this application. Here is a line taken from <a href="http://developer.apple.com/library/mac/#documentation/FileManagement/Conceptual/FileSystemProgrammingGUide/FileSystemOverview/FileSystemOverview.html#//apple_ref/doc/uid/TP40010672-CH2-SW28">Apple’s documentation</a> <em>Put user data in the <application_home>/Documents/. User data is any data that cannot be recreated by your app, such as user documents and other user-generated content.</application_home></em></li>
  <li>tmp folder is used for putting temporary user data. The application developer should be responsible for freeing up the memory occupied by the files in this folder.</li>
  <li>The Library folder can be used to keep files that are not essentially user data files.</li>
</ul>

<p>You can find more information here. Here is a screenshot from Apple’s <a href="http://developer.apple.com/library/mac/#documentation/FileManagement/Conceptual/FileSystemProgrammingGUide/FileSystemOverview/FileSystemOverview.html#//apple_ref/doc/uid/TP40010672-CH2-SW28">documentation</a>.</p>

<p><img src="/images/posts/ios10/5.png" alt="5" /></p>

<h2 id="gathering-information-from-database-files">Gathering information from database files.</h2>

<p>Apple uses sqlite databases to store a lot of its information. These databases usually have the extension <em>.db</em> or <em>.sqlitedb</em>. Many features for developers such as Core Data, NSUserDefaults etc operate from these sqlite databases on a low level. These database files can be used to extract a lot of information for a particular application or from the operating system in general. This could include call history, or stored mails from within an application etc. To find all the .db files, use the command <em>find . -name *.db</em></p>

<p><img src="/images/posts/ios10/6.png" alt="6" /></p>

<p>This gives you a list of all the database files stored within the device. Let’s take a look at some of the important database files.</p>

<p>I have the gmail app installed on my device. This file looks of interest to me.</p>

<p><img src="/images/posts/ios10/7.png" alt="7" /></p>

<p>It looks like this file contains some important information. Let’s analyze this file using the sqlite client. Please note that you will need to install the sqlite client named <em>sqlite3</em> on your device first. Let’s open this file using the command <em>sqlite3 file_name</em>.</p>

<p><img src="/images/posts/ios10/10.png" alt="10" /></p>

<p>You will notice that you get a sqlite interpreter. Let’s turn the headers on so that we can see the headers of all column values. You can then use the command <em>.tables</em> to have a look at all the tables for this database.</p>

<p><img src="/images/posts/ios10/11.png" alt="11" /></p>

<p>Some of the tables that look interesting are <em>cached_contacts</em>, <em>cached_queries</em> and <em>cached_messages</em>. Let’s dump out all the information from the table <em>cached_messages</em></p>

<p><img src="/images/posts/ios10/12.png" alt="12" /></p>

<p>As we can see, it dumps out all the cached emails.</p>

<p>Similarly, we can dump out all the SMS database from the device which is found on the location /private/var/mobile/Library/SMS. In this dump, you can see a message with the text <em>Test message for ios security tutorial</em>.</p>

<p><img src="/images/posts/ios10/13.png" alt="13" /></p>

<p>Another example could be the contacts database. It could be found at the location <em>/var/mobile/Library/AddressBook</em></p>

<p><img src="/images/posts/ios10/a.png" alt="A" /></p>

<p>And you can find the call history at the location <em>/private/var/wireless/Library/CallHistory</em></p>

<p><img src="/images/posts/ios10/b.png" alt="B" /></p>

<p>Sometimes doing all these things through command line might be an overkill and take too much time. A much better way of analysing all this information would have been to export the file that you want to your desktop. For e.g, lets download the Address Book Sqlite database.</p>

<p><img src="/images/posts/ios10/21.png" alt="21" /></p>

<p>We can then analyze this database using a GUI Sqlite client. In my case, i am using <em>MesaSQLite</em>. It’s free and easy to use. In <em>MesaSQLite</em> go to <em>File</em>, then Click on <em>Open Database</em>, select this db file, then inside the <em>Content</em> tab, select a table and click on <em>Show All</em></p>

<p>. <img src="/images/posts/ios10/22.png" alt="22" /></p>

<p>As you can see, a lot of information can be gathered from these database files. I recommend that you try to explore more of these database files in the operating system and also the database files inside every app bundle.</p>

<h2 id="gathering-information-from-plist-files">Gathering information from plist files.</h2>

<p>Plist files are structured text files that are used for storing various settings and configuration for a particular app. Since the information is stored in a structured way in a plist file in key-value pairs, it is very easy to change this information and hence developers sometimes end up storing more information in these files than it should actually be used for.</p>

<p>Even on a non-jailbroken device, plist files can be extracted by using the tool iExplorer. You can also get a quick look at the plist file using iExplorer. For e.g, below is the information stored in a plist file on the Defcon iOS app.</p>

<p><img src="/images/posts/ios10/p.png" alt="P" /></p>

<p>And here is a screenshot from the User.plist file contained in the Snapchat app inside Documents folder. The first highlighted section is actually the authentication token for that particular user and the second highlighted section is the username for that Snapchat user.</p>

<p><img src="/images/posts/ios10/33.png" alt="33" /></p>

<p>Plist files may also contain confidential information like usernames or passwords. The important thing to note is that is that anyone can extract a plist file from a device even if its not jailbroken. You can also extract plist files from itunes backup files. Developers over the last few years have stored confidential information in plist files which is not the correct way. A vulnerability was found in the Linkedin iOS app where the developer was storing user authentication information in plist files. You can find more information about it <a href="http://blog.scoopz.com/2012/04/07/linkedin-ios-app-also-vulnerable-to-plist-identity-theft/">here</a>.</p>

<p>If you want to read the plist file from the terminal itself, you will first have to convert it into xml format using the tool <em>plutil</em>. The command is <em>plutil -covert xml1 [filename]</em>. First, lets search for all the plist files in the device by using the 2 commands as shown in the figure below.</p>

<p>. <img src="/images/posts/ios10/34.png" alt="34" /></p>

<p>Now, let’s covert any one file to xml format.</p>

<p><img src="/images/posts/ios10/35.png" alt="35" /></p>

<p>The file is now organized in a structure format. Let’s open the file using vim.</p>

<p><img src="/images/posts/ios10/36.png" alt="36" /></p>

<p>As you can see, we are now able to analyze the contents of the plist file.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this article, we looked at the iOS filesystem, learnt how the directory structure is organized, looked at some important files and learnt how to extract information from database and plist files. In the next article, we will take a sample application and use all the techniques learnt in the previous articles to perfom a detailed security analysis of the app.</p>

</div>





<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/09/06/arm64-reversing-and-exploitation-part-3-a-simple-rop-chain.html">
            ARM64 Reversing and Exploitation Part 3 - A Simple ROP Chain
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/09/06/arm64-reversing-and-exploitation-part-2-use-after-free.html">
            ARM64 Reversing and Exploitation Part 2 - Use After Free
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/09/05/arm64-reversing-and-exploitation-part-1-arm-instruction-set-heap-overflow.html">
            ARM64 Reversing and Exploitation Part 1 - ARM Instruction Set + Simple Heap Overflow
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/android/" class="set-1">android</a> <a href="/tag/authentication/" class="set-1">authentication</a> <a href="/tag/backtrack/" class="set-1">backtrack</a> <a href="/tag/burpsuite/" class="set-1">burpsuite</a> <a href="/tag/defcon/" class="set-1">defcon</a> <a href="/tag/dns/" class="set-1">dns</a> <a href="/tag/honeypots/" class="set-1">honeypots</a> <a href="/tag/ios/" class="set-1">ios</a> <a href="/tag/maintaining-access/" class="set-1">maintaining-access</a> <a href="/tag/meshnet/" class="set-1">meshnet</a> <a href="/tag/metasploit/" class="set-1">metasploit</a> <a href="/tag/networking/" class="set-1">networking</a> <a href="/tag/privacy/" class="set-1">privacy</a> <a href="/tag/security/" class="set-5">security</a> <a href="/tag/timing-analysis-attacks/" class="set-1">timing-analysis-attacks</a> <a href="/tag/w3af/" class="set-1">w3af</a> <a href="/tag/web-application-security/" class="set-1">web-application-security</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
